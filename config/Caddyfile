powa.lan, 192.168.1.64.nip.io {
  tls internal
  encode zstd gzip

  # --- CORS ---
  header {
    Access-Control-Allow-Origin "*"
    Access-Control-Allow-Methods "GET, POST, PUT, DELETE, PATCH, OPTIONS"
    Access-Control-Allow-Headers "*"
    Access-Control-Max-Age "86400"
  }

  # Preflight handling
  @preflight {
    method OPTIONS
    header Origin *
    header Access-Control-Request-Method *
  }
  respond @preflight 204

  # --- Static files ---
  handle_path /static/* {
    root * /var/www/mytube
    file_server
  }

  # --- API ---
  # Option A: your API serves at "/" â†’ strip /api
  handle /api/* {
    reverse_proxy http://host.docker.internal:8080
  }

  handle /files/* {
    reverse_proxy http://host.docker.internal:8080
  }

  # --- Frontend (everything else) ---
  handle {
    reverse_proxy http://host.docker.internal:3000
  }
}
